webpackJsonp([27],{"+xwE":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n("BO1k"),i=n.n(o),r=n("mvHQ"),a=n.n(r),s=n("pFYg"),d=n.n(s),c=n("Msp2"),l=(n.n(c),n("Bfwr")),p=(n.n(l),n("rLAy")),u=(n.n(p),n("3BeM")),f=n("Y+qm"),x=n("rHil"),g=n.n(x),v=n("1DHf"),m=n.n(v),h=n("YxJB"),b=(n.n(h),n("3Lt7")),w=(n.n(b),n("rGqP")),y=(n.n(w),n("S8Wg")),_=n.n(y),k=n("I3G/"),S=n.n(k),U=n("mtWM"),z=n.n(U);S.a.use(u.a);var j=n("PtV2"),R=n("PZHe"),T=n("gsSi"),C=n("fkXR"),I=C.push_event_app,A=n("e3l2"),B=A.KTVmeBridge;z.a.defaults.timeout=15e3,S.a.use(f.a),e.default={created:function(){this.roomId=this.$route.params.id,console.log(d()(this.roomId)+"12132"),this.getData()},mounted:function(){var t=this;setInterval(function(){t.isShowing&&(t.isShowing=!t.isShowing,setTimeout(function(){t.isShowing=!t.isShowing},100))},8e3)},methods:{randomString:function(t){t=t||32;for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,o="",i=0;i<t;i++)o+=e.charAt(Math.floor(Math.random()*n));return o},sendWish:function(){var t=this;if(console.log("包厢送祝福..."),I({eventId:"event_room_send_wish",param:[]}),!this.isSending){console.log("当前商家系统类型为:"+this.systemType),this.isSending=!0,this.$vux.loading.show({text:"加载中"});var e=j.getRoomSendWish();z.a.post(e,{room_id:this.roomId},{headers:{"x-auth-token":this.token,"x-auth-secid":this.secId}}).then(function(e){var n=e.data;t.$vux.loading.hide(),t.isSending=!1,T(n,{},function(){if(console.log("接收数据：",n),0!=n.ret)return void t.$vux.toast.show({text:n.msg,type:"text",width:"160px"});var e=n.data,o=(e.roomname,e.stbip);e.role,e.phone,e.nickname,e.companycode,e.companyname;if(void 0===o||0==o.length)return void t.$vux.toast.show({text:"未获取到包厢IP~",type:"text",width:"160px"});var i=n.data;i.roomid=t.roomId;var r=encodeURIComponent(a()(i));console.log("参数为:"+r);var s=-1!=window.location.href.indexOf("ktvme.com/"),d=j.getSendWishPageUrl(s);-1!=d.indexOf("?")?d+="&data="+r:d+="?data="+r,d+="&rnd="+t.randomString(16),console.log("包厢送祝福:"+d);var c={action:"push_web",data:d,title:"",tag:"RoomSendWishPage"};try{B.webToNativeRequest(c,"nativeHandler")}catch(t){}})})}},onRefreshUi:function(){var t=this;this.$nextTick(function(){t.$refs.scroller.reset({top:0})})},getData:function(){var t=this;this.box=[],this.wine=[],this.$vux.loading.show({text:"加载中"}),R.getCompanyInfo(function(e){var n=e.token,o=e.secid,r=e.company_ext;t.secId=o,t.token=n;try{var a=JSON.parse(r);void 0!==a.system_type&&(t.systemType=a.system_type)}catch(t){}var s=R.getCompanyCodeByUrl(),d=R.getVoucherByUrl(),c=j.getRoomInfoUrl(s);z.a.post(c,{companyCode:s,roomId:t.roomId,voucher:d},{headers:{"x-auth-token":n,"x-auth-secid":o}}).then(function(e){var n=e.data;t.$vux.loading.hide(),T(n,{},function(){if(console.log("接收数据：",n),0==n.ret){var e=[n.data.box,n.data.wine];t.box=e[0],t.wine=e[1],null==t.wine&&(t.wine=[]),t.wineSum=0;var o=!0,r=!1,a=void 0;try{for(var s,d=i()(t.wine);!(o=(s=d.next()).done);o=!0){var c=s.value;try{var l=parseFloat(c.account);isNaN(l)||(t.wineSum+=l,t.wineSum=parseFloat(t.wineSum.toFixed(2)))}catch(t){}}}catch(t){r=!0,a=t}finally{try{!o&&d.return&&d.return()}finally{if(r)throw a}}t.onRefreshUi()}else"undefine"!=typeof n.msg&&n.msg.length>0?t.errorMsg=n.msg:t.errorMsg="暂无包厢详情数据"})}).catch(function(e){t.netErr=!0,t.$vux.loading.hide()})})}},filters:{getWineCount:function(t){}},components:{Scroller:_.a,Group:g.a,Cell:m.a},data:function(){return{isSending:!1,roomId:"",secId:"",token:"",systemType:0,wineSum:0,netErr:!1,box:[],wine:[],errorMsg:"暂无包厢详情数据",isShowing:!0}}}},"9TVd":function(t,e,n){n("d/Fz");var o=n("VU/8")(n("+xwE"),n("wyQc"),"data-v-7bee0dd0",null);t.exports=o.exports},PtV2:function(t,e,n){var o=n("CWSs");t.exports={cancelBookingUrl3PX:function(){return o.createAjaxUrl("/biz/3px/cancel_booking")},cancelBookingUrl:function(){return o.createAjaxUrl("/biz/3p/cancel_booking")},get3pLogUrl:function(){return o.createAjaxUrl("biz/3p_log/list")},getRoomPresentSendUrl:function(){return o.createAjaxUrl("biz/3px/present/wine")},getRoomPresentLimitUrl:function(){return o.createAjaxUrl("biz/3px/present/limit")},getGoodsDetailUrl:function(){return o.createAjaxUrl("biz/3p/present/set")},getGoodsListUrl:function(){return o.createAjaxUrl("biz/3px/present/menu")},getRoomOrderUrl:function(){return o.createAjaxUrl("biz/3px/booking")},getRoomDiscountUrl:function(){return o.createAjaxUrl("biz/3px/discount")},getRoomDiscountLimitUrl:function(){return o.createAjaxUrl("biz/3px/discount/limit")},getRoomListUrl:function(){return o.createAjaxUrl("rooms/states")},getRoomListUrl2:function(){return o.createAjaxUrl("biz3/box_states")},getRoomInfoUrl:function(t){return""==t?o.createAjaxUrl("biz3/box_info?companycode="+t):o.createAjaxUrl("biz3/jumpin_box?companycode="+t)},getRoomMemberInfoUrl:function(){return o.createAjaxUrl("nbs/member_info")},getRoomSendWish:function(){return o.createAjaxUrl("biz/wish/info")},getSendWishPageUrl:function(t){return t?"http://www.ktvme.com/bless/merchants":"http://192.168.97.106/bless/merchants?kpm_channel=01230123"},roomStaetConvert:function(t){var e={1:[1,"空闲"],2:[2,"结帐"],7:[2,"结帐"],3:[3,"预订"],4:[4,"锁定"],14:[4,"锁定"],5:[5,"使用"],10:[10,"带客"],12:[12,"故障"],16:[16,"买钟"],17:[17,"清洁"],22:[22,"测机"]};return void 0==e[t]?[0,"非开房"]:e[t]},colorMap:{0:"#000",1:"#7ecae4",7:"#57bc54",2:"#57bc54",4:"#2882d8",5:"#dc5563",3:"#9958b4",6:"#dc5563",8:"#dc5563",9:"#dc5563",10:"#e2551d",12:"#54575d",16:"#fea531",17:"#22BCBC",18:"#dc5563",19:"#dc5563",22:"#AD1488"}}},TcJg:function(t,e,n){t.exports=n.p+"static/img/send_wish.48278a5.png"},"d/Fz":function(t,e,n){var o=n("yvTb");"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);n("rjj0")("253227a0",o,!0)},fkXR:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"push_event",function(){return a}),n.d(e,"push_event_app",function(){return r});var o=n("e3l2"),i=o.KTVmeBridge,r=function(t){var e=t.eventId,n=t.param,o={action:"event",data:"0",eventId:e,param:{}};if(n.map(function(t,e){o.param["param"+(0==e?"":e)]=t}),console.log("事件统计数据：",o),void 0!==window.appVersion)try{i.webToNativeRequest(o,"nativeHandler")}catch(t){}},a=function(t){var e=t.category,n=t.action,o=void 0===n?"点击":n,i=t.label,r=void 0===i?void 0:i,a=t.value,s=void 0===a?0:a;"undefined"!=typeof _czc&&_czc.push(["_trackEvent",e,o,r,s,void 0])}},gsSi:function(t,e,n){var o=n("e3l2"),i=o.KTVmeBridge,r=n("tpu8"),a=r.memoize(function(){var t={action:"invalid_token",data:""};try{i.webToNativeRequest(t,"nativeHandler")}catch(t){}});t.exports=function(t,e,n){9e4==t.ret?a():n()}},wyQc:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"box"},[n("scroller",{ref:"scroller",staticStyle:{height:"100%",width:"100%"},attrs:{"lock-x":""}},[n("div",{staticClass:"box2 list-inner"},[t.netErr?n("div",{staticStyle:{"text-align":"center","font-size":"16px","margin-top":"50%",color:"#ccc"},on:{click:function(e){t.getData()}}},[t._v("\n                    网络错误，请点击重试\n                ")]):t._e(),t._v(" "),t.netErr?t._e():n("div",[t.box&&0==t.box.length&&t.wine&&0==t.wine.length?n("div",{staticStyle:{"text-align":"center","font-size":"16px","margin-top":"50%",color:"#ccc"}},[t._v("\n                        "+t._s(t.errorMsg)+"\n                    ")]):t._e(),t._v(" "),t.box.length>0?n("div",[n("div",{staticClass:"box-title",staticStyle:{"border-bottom":"none"}},[t._v("基本信息")]),t._v(" "),n("group",t._l(t.box,function(t){return n("cell",{staticClass:"box-item",attrs:{title:t.showtitle,value:t.showvalue}})}))],1):t._e(),t._v(" "),t.wine.length>0?n("div",[n("div",{staticClass:"box-title",staticStyle:{"border-top":"none"}},[t._v("商品信息"),n("span",{staticStyle:{float:"right",color:"#000"}},[t._v("总计 : "+t._s(t.wineSum))])]),t._v(" "),n("div",{staticClass:"goods-list"},t._l(t.wine,function(e){return n("div",{staticClass:"goods-item"},[n("div",{staticClass:"name"},[n("span",[t._v(t._s(e.name))]),t._v(" "),"赠送"==e.orderType?n("span",{staticStyle:{background:"red",color:"#fff","margin-left":"5px",padding:"3px","border-radius":"4px","font-size":"10px","line-height":"10px"}},[t._v("\n\t\t\t\t\t\t\t\t\t\t赠\n\t\t\t\t\t\t\t\t\t")]):t._e(),t._v(" "),"例送"==e.orderType?n("span",{staticStyle:{background:"red",color:"#fff","margin-left":"5px",padding:"3px","border-radius":"4px","font-size":"10px","line-height":"10px"}},[t._v("\n\t\t\t\t\t\t\t\t\t\t例\n\t\t\t\t\t\t\t\t\t")]):t._e()]),t._v(" "),n("div",{staticClass:"desc"},[n("div",[t._v("￥"+t._s(e.sellprice)+" X "+t._s(e.sellnum))]),t._v(" "),n("div",[t._v("小计：\n                                        "+t._s(e.account)+"\n                                        "),""==e.account?n("span",[t._v("--")]):t._e()])])])}))]):t._e()])])]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowing&&(1==t.systemType||2==t.systemType),expression:"isShowing && (systemType == 1 || systemType == 2)"}],staticClass:"send-wish animated bounceIn",attrs:{id:"send_wish"},on:{click:t.sendWish}},[n("span")])],1)},staticRenderFns:[]}},yvTb:function(t,e,n){e=t.exports=n("FZ+f")(),e.push([t.i,"\n.box[data-v-7bee0dd0] {\n  background: #f2f2f2;\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  left: 0;\n  top: 0;\n}\n.box .box-title[data-v-7bee0dd0] {\n  background: #F2F2F2;\n  padding: 0px 15px;\n  height: 35px;\n  line-height: 35px;\n  color: #898989;\n  font-size: 14px;\n  overflow: hidden;\n  border-top: 1px solid #dfdfdf;\n  border-bottom: 1px solid #dfdfdf;\n  background-color: #f0eff4;\n}\n.box .box-title .box-item[data-v-7bee0dd0] {\n  font-size: 14px;\n}\n.box .goods-list[data-v-7bee0dd0] {\n  padding-left: 15px;\n  background: #ffffff;\n  border-bottom: 1px solid #dfdfdf;\n}\n.box .goods-list .goods-item[data-v-7bee0dd0]:last-child {\n  border-bottom: 0px none;\n}\n.box .goods-list .goods-item[data-v-7bee0dd0] {\n  padding-top: 5px;\n  padding-bottom: 5px;\n  border-bottom: 1px solid #f4f4f4;\n  color: #666666;\n  font-size: 13px;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: flex;\n}\n.box .goods-list .goods-item .name[data-v-7bee0dd0] {\n  -webkit-box-flex: 1;\n  -webkit-flex: 1;\n          flex: 1;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n          align-items: center;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: flex;\n  font-size: 13px;\n}\n.box .goods-list .goods-item .desc[data-v-7bee0dd0] {\n  text-align: right;\n  padding-right: 15px;\n}\n.box .send-wish[data-v-7bee0dd0] {\n  position: fixed;\n  right: 15px;\n  bottom: 20px;\n  width: 65px;\n  height: 65px;\n  display: -webkit-box;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n          justify-content: center;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n          align-items: center;\n}\n.box .send-wish span[data-v-7bee0dd0] {\n  width: 100%;\n  height: 100%;\n  background-image: url("+n("TcJg")+");\n  background-size: 100% 100%;\n}\n",""])}});